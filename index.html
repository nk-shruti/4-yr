<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>fourth year lesgooo!</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
        #qr-container { display: none; margin-top: 20px; }
    </style>
</head>
<body>
    <h2> MISSION OBJECTIVE: CULINARY LOCATION ACQUISITION </h2>
    <p> !!!! FOLLOW THE CLUES TO THE DESIGNATED LOCATIONS OR FACE STARVATION !!!
    <p> Each successfully retrieved data fragment will grant you access to classified intelligence, a reward you will be thankful for and a step closer to a luxurious meal.</p>
    <p> BUT BE WARNED!! Incorrect location identification will trigger <b> COMPLIANCE ENFORCEMENT </b> – you will be punished with a dare that must be complete to successfully reprogram your behavior to lead to better predictions.</p>
    <p> Fail too many times… and hunger will be your only companion.</p>
    <p> REMEMBER – the closer you are to the target, the more accurate the data retrieval.</p> 
    <p> Good luck, Operative. Your appetite depends on it.</p>
    <p> WARNING: SYSTEM PROGRESS CANNOT BE RECOVERED!</p>
    <p> If you close this tab, ALL progress will be lost—your mission will reset, and you’ll have to start over from zero.</p>.<br><br>
    <p> Do not take this lightly. Ensure you have at least two devices for optimal tracking. Your survival may depend on it. Proceed carefully.
    </p>
    <button onclick="checkLocation()">Engage Retrieval Protocol</button>
    <div id="qr-container">
        <h3>DATA CODE LOCATED - PROCEED WITH EXTRACTION</h3>
        <canvas id="qr-code"></canvas>
    </div>

    <script>
        var currentStep = 0;
        // List of locations (latitude, longitude, QR code links)
        const locations = [
            { lat: 47.626592, lon: -122.341850, qr: "https://internal-snowdrop-60d.notion.site/Clue-1-1aaefcf01d4280b580eae19cd9130e77" },
            { lat: 47.6246, lon: -122.3366, qr: "https://internal-snowdrop-60d.notion.site/Clue-1-1aaefcf01d4280b580eae19cd9130e77" },
            { lat: 47.6246, lon: -122.3366, qr: "https://internal-snowdrop-60d.notion.site/Clue-1-1aaefcf01d4280b580eae19cd9130e77" },
            { lat: 47.6246, lon: -122.3366, qr: "https://internal-snowdrop-60d.notion.site/Clue-1-1aaefcf01d4280b580eae19cd9130e77" },
            { lat: 47.6246, lon: -122.3366, qr: "https://internal-snowdrop-60d.notion.site/Clue-1-1aaefcf01d4280b580eae19cd9130e77" },
            { lat: 47.6141, lon: -122.3453, qr: "https://internal-snowdrop-60d.notion.site/Clue-1-1aaefcf01d4280b580eae19cd9130e77" }
        ];
        
        window.checkLocation = function() {
            alert("activating scanner .... synchronizing with satellite ...");
            // code to ask "Are you sure?" before continuing
            // if no, don't check
            // if yes, continue
            


            if (navigator.geolocation) {
                // how to remember the state??
                navigator.geolocation.getCurrentPosition(position => {
                    let userLat = position.coords.latitude;
                    let userLon = position.coords.longitude;
                    
                    // alert(`Your current location:\nLatitude: ${userLat}\nLongitude: ${userLon}`); // Debugging alert to show location
                    
                    let target = locations[currentStep];
                    if (isNearLocation(userLat, userLon, target.lat, target.lon)) {
                        showQRCode(target.qr);
                        currentStep++; // Move to the next step
                        
                        if (currentStep >= locations.length) {
                            alert("[MISSION COMPLETE] All fragments secured. Proceed to final reward: DINNER. Location details in #539");
                        } else {
                            alert("[NEXT OBJECTIVE] Proceed to the next data fragment site. You are one step closer to avoiding starvation.");
                        }
                    } else {
                        triggerDare();
                    }
                }, () => alert("[ALERT] Tracking failure. GPS disabled or anomalous interference detected."));
            } else {
                alert("[CRITICAL FAILURE] Geolocation is not supported by this browser. Manual override required.");
            }
        }
        function isNearLocation(userLat, userLon, targetLat, targetLon) {
            let distance = Math.sqrt(Math.pow(userLat - targetLat, 2) + Math.pow(userLon - targetLon, 2));
            alert(`Distance!! : ${distance}`);
            return distance < 0.00002; // Adjust the threshold as needed
        }
        
        function showQRCode(url) {
            let qr = new QRious({ element: document.getElementById("qr-code"), value: url, size: 200 });
            document.getElementById("qr-container").style.display = "block";
            alert("[SUCCESS] Data fragment retrieved. Standby for next directive."); // Pop-up when QR code is revealed
        }
        function triggerDare() {
            const dares = [
                "Wear mismatched socks for 30 minutes.",
                "Prounounce HAZARD as ha-zzard for the next 10 times you say it.",
                "Do the V-step in front of strangers.",
                "Speak in an INDIAN accent for the next 5 minutes.",
                "Wear Shru's ugly christmas sweater for the next 30 minutes."
            ];
            let dare = dares[Math.floor(Math.random() * dares.length)];
            alert(`[WARNING] Incorrect location detected. To proceed, you MUST complete the following behavior reprogramming task: \n\n${dare}`);
        }
    </script>
</body>
</html>