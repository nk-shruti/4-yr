<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>fourth year lesgooo!</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
        #qr-container { display: none; margin-top: 20px; }
    </style>
</head>
<body>
    <h2> MISSING DIRECTIVE: find out where we are going to celebrate 1460 days together on this planet. </h2>
    <p>  !!!! FOLLOW THE CLUES AND DRIVE TO THE RIGHT LOCATION TO ACTIVATE NEXT CLUE !!!
        in addition to the next clue, you will recieve a <br><reward<br> for every right location
        BUT BEWARE! if you get it wrong, you will be punished with a dare you MUST complete in order to go on.
        GOOD LUCK, and may the odds be ever in your favor! <br><br>

        PLEASE NOTE: do not close this tab, otherwise ALL PROGRESS WILL BE LOST.
        I repeat ALL PROGRESS WILL BE LOST.<br><br>
        Do not take this warning lightly. Ensure you have at least 2 devices to follow along.
    </p>
    <button onclick="checkLocation()">click if you're sure!</button>
    <div id="qr-container">
        <h3>you may scan the QR code to get information on the next cloe</h3>
        <canvas id="qr-code"></canvas>
    </div>

    <script>
        var currentStep = 0;
        // List of locations (latitude, longitude, QR code links)
        const locations = [
            { lat: 47.6145, lon: -122.3208, qr: "https://internal-snowdrop-60d.notion.site/Clue-1-1aaefcf01d4280b580eae19cd9130e77" },
            { lat: 47.6246, lon: -122.3366, qr: "https://internal-snowdrop-60d.notion.site/Clue-1-1aaefcf01d4280b580eae19cd9130e77" },
            { lat: 47.6246, lon: -122.3366, qr: "https://internal-snowdrop-60d.notion.site/Clue-1-1aaefcf01d4280b580eae19cd9130e77" },
            { lat: 47.6246, lon: -122.3366, qr: "https://internal-snowdrop-60d.notion.site/Clue-1-1aaefcf01d4280b580eae19cd9130e77" },
            { lat: 47.6246, lon: -122.3366, qr: "https://internal-snowdrop-60d.notion.site/Clue-1-1aaefcf01d4280b580eae19cd9130e77" },
            { lat: 47.6141, lon: -122.3453, qr: "https://internal-snowdrop-60d.notion.site/Clue-1-1aaefcf01d4280b580eae19cd9130e77" }
        ];
        
        window.checkLocation = function() {
            alert("activating scanner .... synchronizing with satellite ...");
            // code to ask "Are you sure?" before continuing
            // if no, don't check
            // if yes, continue
            


            if (navigator.geolocation) {
                // how to remember the state??
                navigator.geolocation.getCurrentPosition(position => {
                    let userLat = position.coords.latitude;
                    let userLon = position.coords.longitude;
                    
                    // alert(`Your current location:\nLatitude: ${userLat}\nLongitude: ${userLon}`); // Debugging alert to show location
                    
                    let target = locations[currentStep];
                    if (isNearLocation(userLat, userLon, target.lat, target.lon)) {
                        showQRCode(target.qr);
                        currentStep++; // Move to the next step
                        
                        if (currentStep >= locations.length) {
                            alert("Congrats on mission completion! Your final reward awaits at room # 539.");
                        } else {
                            alert("Congratulations on passing round " + currentStep + "! On to the next.");
                        }
                    } else {
                        alert("NEGATIVE!! You're not at the right location yet. Try again!");
                    }
                }, () => alert("Could not retrieve your location. Enable GPS and try again."));
            } else {
                alert("Geolocation is not supported by this browser.");
            }
        }
        function isNearLocation(userLat, userLon, targetLat, targetLon) {
            let distance = Math.sqrt(Math.pow(userLat - targetLat, 2) + Math.pow(userLon - targetLon, 2));
            alert(`Distance!! : ${distance}`);
            return distance < 2; // Adjust the threshold as needed
        }
        
        function showQRCode(url) {
            let qr = new QRious({ element: document.getElementById("qr-code"), value: url, size: 200 });
            document.getElementById("qr-container").style.display = "block";
            alert("Success! QR code unlocked."); // Pop-up when QR code is revealed
        }
    </script>
</body>
</html>